(()=>{"use strict";var e=function(e,t){if(e.length!==t.length)return!1;for(var s=0;s<e.length;s++)if(!t.includes(e[s]))return!1;return!0};function t(e){e&&document.querySelector(e.selector)&&document.querySelector(e.selector).addEventListener("click",(function(){var t=document.querySelector(e.input),s="";switch(e.input){case"#wdss-jsonld-schema-orgname input":s=wdss_localize.site_name;break;case"#wdss-jsonld-schema-email input":s=wdss_localize.site_email}t.value=s}))}var s=function(e,t){setTimeout((function(){e.remove()}),t)};function o(e){var t=document.querySelector(e.toggler),s=t.hasAttribute("checked"),o=document.querySelector(e.target);s&&o.classList.toggle("hidden"),t.addEventListener("click",(function(){o.classList.toggle("hidden")}))}function n(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach((function(e){Array.from(document.querySelectorAll(e.button)).forEach((function(t){t.addEventListener("click",(function(){var s=t.closest("div").querySelector(e.target);""!==s.value&&confirm("Are you sure?")&&(s.value="")}))}))}))}function c(e){e.setAttribute("checked","checked"),e.checked=!0}function a(e){e.removeAttribute("checked"),e.checked=!1}var r={toggler:"#wdss-auto-featured-image-condition input",target:"#wdss-featured-images-group"},i={toggler:"#wdss-polylang-meta-data-condition input",target:"#wdss-polylang-meta-data-group"},l={button:"#wdss-featured-images-group button.reset",target:"#wdss-featured-images-group input"},d={button:"#wdss-jsonld-schema-logo button.reset",target:"#wdss-jsonld-schema-logo input"},u={select:".image-chooser.featured button.choose",target:".image-chooser.featured input",is_multiple:!0,title:"Select Featured Images"},m={select:".image-chooser.logo button.choose",target:".image-chooser.logo input",is_multiple:!1,title:"Select Organization Logo"},f={selector:"#wdss-generate-orgname",input:"#wdss-jsonld-schema-orgname input"},g={selector:"#wdss-generate-email",input:"#wdss-jsonld-schema-email input"},v={root_el:"#custom-410s-list-settings",action:"e410_dictionary_update",nonce:"e410-dictionary-nonce",name:"e410_dictionary"},p={root_el:"#images-settings",action:"excluded_hosts_dictionary_update",nonce:"excluded-hosts-dictionary-nonce",name:"excluded_hosts_dictionary"};function h(e,t,s,o,n,c,a){try{var r=e[c](a),i=r.value}catch(e){return void s(e)}r.done?t(i):Promise.resolve(i).then(o,n)}function y(e){return function(){var t=this,s=arguments;return new Promise((function(o,n){var c=e.apply(t,s);function a(e){h(c,o,n,a,r,"next",e)}function r(e){h(c,o,n,a,r,"throw",e)}a(void 0)}))}}function w(e){Array.from(document.querySelectorAll(e.select)).forEach((function(t){t.addEventListener("click",(function(s){var o;s.preventDefault(),(o=wp.media({title:e.title,multiple:e.is_multiple,library:{type:"image"},button:{text:"Select"}})).on("close",(function(){var s=t.closest(".image-chooser.featured"),n=t.closest(".image-chooser.logo"),c=o.state().get("selection"),a=new Array,r=new Array,i=0;if(s){c.forEach((function(e){a[i]=e.id,i++}));var l=a.join(",");s.querySelector(e.target).value=l}else if(n){c.forEach((function(e){r[i]=e.attributes.url,i++}));var d=r.join(",");n.querySelector(e.target).value=d}})),o.on("open",(function(){var s=t.closest(".wdss-setting-item.image-chooser"),n=o.state().get("selection");s.querySelector(e.target).value.split(",").forEach((function(e){var t=wp.media.attachment(e);t.fetch(),n.add(t?[t]:[])}))})),o.open()}))}))}function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t){var o=function(){var e=jQuery("".concat(t.root_el," .wdss-list-table tbody tr")),o=[];e.each((function(e,t){var s=t.querySelector("td:nth-of-type(1)").textContent;o.push(s)}));var n={action:t.action,security:t.nonce};n[t.name]=o,jQuery.ajax({url:wdss_localize.url,type:"post",dataType:"json",data:n,success:function(e){var t=r.querySelector(".wdss-list-table-actions span");t&&t.remove(),l.insertAdjacentHTML("afterend",'<span class="msg successful">Table was updated</span>'),s(r.querySelector("span.msg"),1200),l.classList.add("saved")},fail:function(e){var t=r.querySelector(".wdss-list-table-actions span");t&&t.remove(),l.insertAdjacentHTML("afterend",'<span class="msg error">Error, look at information in console</span>'),s(r.querySelector("span.msg"),1200),console.log(e)}})},n=function(){if(m.value){l.classList.remove("saved");var e=m.value;m.value="",u.insertAdjacentHTML("beforeend",'\n        <tr id="'.concat(wdss_localize.wp_rand,'">\n          <td>').concat(e,'</td>\n          <td class="wdss-list-table__remove-item"><i class="fas fa-trash"></i></td>\n        </tr>\n        '))}},c=function(){l.classList.remove("saved"),confirm("Remove this rule from table?")&&this.closest("tr").remove()},a=function(s){var o,n=jQuery("".concat(t.root_el," .wdss-list-table tbody tr")),c=[];jQuery.each(n,(function(){c.push(this.id)})),e(g,c)&&(o=!0),o||l.classList.contains("saved")||confirm("All unsaved changes will be lost. Do you want to continue?")||s.preventDefault()},r=document.querySelector(t.root_el),i=r.querySelector(".wdss-list-item-handler.add"),l=r.querySelector(".save-dictionary"),d=document.querySelector("#wdss-settings-page form"),u=r.querySelector(".wdss-list-table tbody"),m=r.querySelector('input[type="text"]'),f=jQuery("".concat(t.root_el," .wdss-list-table tbody tr")),g=[];jQuery.each(f,(function(){g.push(this.id)})),l.addEventListener("click",o),i.addEventListener("click",n),jQuery(document).on("click","".concat(t.root_el," .wdss-list-table__remove-item i"),c),d.addEventListener("submit",a)}}var _=document.querySelector("#wdss-settings-page");document.addEventListener("DOMContentLoaded",(function(){var e,s,h,b,L,q,k,E,A;_&&(b=document.querySelector("html"),L=document.querySelector(".wdss-modal"),q=document.querySelector("#wdss-remove-broken-featured__choose"),k=document.querySelector(".wdss-modal-header i.fa-times"),E=wdss_localize.total_post_count,A=Math.ceil(E/100),console.log("Total fetchable pages: ".concat(A)),window.is_setup_stage=!0,q&&q.addEventListener("mousedown",(function(){var e,t,s=L.querySelector(".wdss-modal-body"),o=L.querySelector(".wdss-modal-informaion-panel"),n=document.querySelector("#wdss-exclude-posts-table tbody"),r=L.querySelector(".wdss-button.submit"),i=L.querySelector(".wdss-button.toggle-all"),l=L.querySelector(".wdss-button.get-posts"),d=L.querySelector(".wdss-modal-posts-count"),u=d.querySelector("strong"),m=L.querySelector(".wdss-modal-welcome-msg"),f='<span class="wdss-modal-not-found-msg">No results...</span>',g=L.querySelector(".wdss-modal-title"),v=[],p=!1;if(!0===window.is_setup_stage){g.insertAdjacentHTML("afterbegin","Delete Broken Featured Images");var h=parseInt(prompt("Enter max posts per fetch count. The minimum is 100: ")),w="<small>Lite-mode: max ".concat(t=h>=100?h:800," posts per fetches</small>");E>t&&(p=!0,g&&g.insertAdjacentHTML("afterend",w)),p&&(E=t)}var S=Math.ceil(E/100);function _(){L.classList.remove("active"),b.classList.remove("fixed")}function q(){var e=Array.from(document.querySelectorAll(".wdss-table-row.post")).length;if(d.classList.add("active"),u)return u.innerHTML=e}function j(){Array.from(document.querySelectorAll(".wdss-table-row.post")).forEach((function(e){var t=e.querySelector('.wdss-table-post__select input[type="checkbox"]');t.hasAttribute("checked")?a(t):c(t)}))}function N(){return(N=y(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){for(var e=[],t=function(t){try{e.push(new Promise((function(e,s){fetch(document.location.origin+"/wp-json/wp/v2/posts?per_page=100&page=".concat(t)).then((function(e){return e.json()})).then((function(t){v=v.concat(t),e()})).catch((function(e){console.log(e),s()}))})))}catch(e){return"break"}},s=1;s<=S&&"break"!==t(s);s++);return++S<A?console.log("Next page to fetch: ".concat(S)):console.log("This is the last page to fetch"),Promise.allSettled(e)},s.classList.add("loading"),e.next=4,t();case 4:console.log("Fetched posts in first query: ".concat(v.length)),jQuery.ajax({url:wdss_localize.url,type:"post",data:{fetched_list:JSON.stringify(v),action:"fetch_broken_featured",broken_featured_nonce1:wdss_localize.broken_featured_list_nonce},success:function(e){x.call(n,e),s.classList.remove("loading"),l.classList.add("inactive")}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(t){this.insertAdjacentHTML("beforeend",t),q();var m=Array.from(document.querySelectorAll(".wdss-table-row.post"));p&&!L.querySelector(".wdss-button.load-more")&&(l.insertAdjacentHTML("beforebegin",'<button type="button" class="wdss-button load-more">Fetch next page</button>'),e=L.querySelector(".wdss-button.load-more")),e&&e.addEventListener("click",(function(){!function(){if(i.addEventListener("click",j),A===S)return alert("You achived the last page"),void e.classList.add("inactive");var t=L.querySelector(".wdss-modal-not-found-msg");t&&t.remove(),e.classList.add("inactive"),s.classList.add("loading"),i.classList.add("inactive"),r.classList.add("inactive");try{fetch(document.location.origin+"/wp-json/wp/v2/posts?per_page=100&page=".concat(S)).then((function(e){return e.json()})).then((function(c){jQuery.ajax({url:wdss_localize.url,type:"post",data:{fetched_list:JSON.stringify(c),action:"fetch_broken_featured",broken_featured_nonce1:wdss_localize.broken_featured_list_nonce},success:function(c){console.log("Current fetched pages: ".concat(S)),++S<A?console.log("Next page to fetch: ".concat(S)):console.log("This is the last page to fetch");var a=Array.from(L.querySelectorAll(".msg"));a&&a.forEach((function(e){return e.remove()})),s.classList.remove("loading"),e.classList.remove("inactive"),c?(n.insertAdjacentHTML("beforeend",c),t&&t.remove(),i.classList.remove("inactive"),r.classList.remove("inactive")):o.insertAdjacentHTML("afterbegin",f),q()}})}))}catch(e){console.log(e)}}()})),m.length>0?(m.forEach((function(e){e.addEventListener("click",(function(){var t=e.querySelector('.wdss-table-post__select input[type="checkbox"]');t.hasAttribute("checked")?a(t):c(t)}))})),l.classList.add("inactive"),r.classList.remove("inactive"),i.classList.remove("inactive"),i.addEventListener("click",j)):(o.insertAdjacentHTML("afterbegin",f),i.classList.add("inactive"),r.classList.add("inactive")),r.addEventListener("click",(function(){var e,t=Array.from(L.querySelectorAll('.wdss-table-post__select input[type="checkbox"]:checked')),s=[];t.length?confirm("Are you ready to start?")&&(l.classList.remove("inactive"),t.forEach((function(e){s.push(e.value)})),e=s.join(","),console.log("Selected IDs: ".concat(e)),r.classList.add("inactive"),i.classList.add("inactive"),d.classList.remove("active"),u.innerHTML="",Array.from(L.querySelectorAll(".wdss-table-row.post")).forEach((function(e){e.parentNode.removeChild(e)})),jQuery.ajax({url:wdss_localize.url,type:"post",data:{selected_list:JSON.stringify(e),action:"remove_broken_featured",broken_featured_nonce2:wdss_localize.remove_broken_featured_nonce},success:function(){l.classList.add("inactive"),o.insertAdjacentHTML("afterbegin",'<span class="msg successful">Completed!<br><small>Please wait several minutes while changes are implementing</small></span>')},error:function(e){o.insertAdjacentHTML("afterbegin",'<span class="msg error">An Error occured!<br><smallLook in console for more details</small></span>'),console.log(e)}})):alert("Please, select the posts which will be proceded")}))}window.is_setup_stage=!1,L.classList.add("active"),b.classList.add("fixed"),k.addEventListener("click",_),document.onkeydown=function(e){return"Esc"===e.key||"Escape"===e.key?_():null},l.addEventListener("click",(function(){var e=L.querySelector(".msg");e&&e.remove(),l.classList.add("inactive"),m.classList.remove("active");var t=L.querySelector(".wdss-modal-not-found-msg");t&&t.remove(),console.log("Current fetched pages: ".concat(S)),S=Math.ceil(E/100),function(){N.apply(this,arguments)}()}))})),document.querySelectorAll(".wdss-section:not(#wdss-snippets-settings) > .wdss-row").forEach((function(e){e.classList.contains("pinned")||e.classList.add("hidden");var t=e.previousElementSibling,s=t.querySelectorAll(".section-toggler");function o(){t.classList.toggle("active"),e.classList.toggle("hidden")}s&&s.forEach((function(e){e.addEventListener("click",o)}))})),function(){var e=document.querySelectorAll(".wdss-section .section-pin"),t=document.querySelectorAll(".wdss-section:not(#wdss-snippets-settings)");function s(){var e,t,s,o=this.closest(".wdss-section-header"),n=o.closest(".wdss-section").getAttribute("id");(JSON.parse(localStorage.getItem("PINNED_WDS_SECTIONS"))||[]).includes(n)?(this.classList.remove("active"),o.querySelector("h2").classList.remove("pinned"),o.querySelector("i.section-toggler").classList.remove("disabled"),e=n,-1!==(s=(t=JSON.parse(localStorage.getItem("PINNED_WDS_SECTIONS"))||[]).indexOf(e))&&t.splice(s,1),localStorage.setItem("PINNED_WDS_SECTIONS",JSON.stringify(t))):(this.classList.add("active"),o.classList.add("active"),function(e){var t=JSON.parse(localStorage.getItem("PINNED_WDS_SECTIONS"))||[];t.push(e),localStorage.setItem("PINNED_WDS_SECTIONS",JSON.stringify(t))}(n),o.querySelector("h2").classList.add("pinned"),o.querySelector("i.section-toggler").classList.add("disabled"))}!function(){var e;localStorage.getItem("PINNED_WDS_SECTIONS")?e=localStorage.getItem("PINNED_WDS_SECTIONS"):(e=[],localStorage.setItem("PINNED_WDS_SECTIONS",JSON.stringify(e)));var s=e;t.forEach((function(e){var t=e.getAttribute("id"),o=e.querySelector(".wdss-section-header"),n=o.nextElementSibling;s.includes(t)&&(e.classList.add("pinned"),o.querySelector("i.section-pin").classList.add("active"),o.querySelector("i.section-toggler").classList.add("disabled"),o.classList.add("active"),o.querySelector("h2").classList.add("pinned"),n.classList.remove("hidden"))}))}(),e.forEach((function(e){e.addEventListener("click",s)}))}(),wdss_localize.total_post_count>0&&(o(r),w(u),n(l),t(g)),wdss_localize.is_polylang_exists&&wdss_localize.is_polylang_setup&&o(i),S(v),wdss_localize.total_post_count>0&&S(p),w(m),n(d),e=document.querySelector("#wdss-advanced-jsonld-schema-condition input"),s=document.querySelector(".wdss-jsonld-schema-predifined-settings"),e.hasAttribute("checked")&&s.classList.add("disabled"),e.addEventListener("click",(function(){s.classList.contains("disabled")?s.classList.remove("disabled"):s.classList.add("disabled")})),t(f),Array.from(document.querySelectorAll('input[type="checkbox"')).forEach((function(e){e.addEventListener("click",(function(){e.hasAttribute("checked")?(e.removeAttribute("checked"),e.value=0,e.checked=!1):(e.setAttribute("checked","checked"),e.checked=!0,e.value=1)}))})),h=Array.from(document.querySelectorAll("#wdss-snippets-settings input")),document.querySelector("#wdss-toggle-options").addEventListener("click",(function(){h[0].hasAttribute("checked")?h.forEach((function(e){e.removeAttribute("checked"),e.checked=!1})):h.forEach((function(e){e.setAttribute("checked","checked"),e.checked=!0}))})),Array.from(document.querySelectorAll(".wdss-setting-item-accordion")).forEach((function(e){var t=e.nextElementSibling;e.addEventListener("click",(function(){t.classList.contains("active")?(e.classList.remove("opened"),t.classList.remove("active")):(e.classList.add("opened"),t.classList.add("active"))}))})))}))})();